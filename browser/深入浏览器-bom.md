# 深入浏览器-bom

## 1 浏览器基本构造

浏览器：用户界面、

### 1.1 内核

浏览器内核：渲染引擎、js引擎

渲染引擎：负责获取网页内容(htnml, xml, img, js, css)、生成 dom tree、生成样式表、生成 render tree

js引擎：解析和执行 js 来实现动态网页效果

> 通常所说的内核，就是浏览器的渲染引擎

### 1.2 常见内核

trident: ie, 360兼容, 搜狗

gecko: firefox

webkit: safari, chrome

blink: chrome opera

> blink 属于 webkit 的一个分支

## 2 浏览器如何加载网页

1. 用户输入网址: 浏览器解析url，检查网址是否正确
2. 选择协议： 检查htts列表, 采用 http 还是　https
3. dns 查询：浏览器缓存(chrome://net-internals/#dns), dns 服务器查询(arp 协议)，获取目标 ip 地址
4. tls 4次握手
5. tcp 3次握手：`syn` -> `syn + ack` -> `ack + data`
6. http 数据请求，服务器返回静态资源
7. 

### 2.1 tls 4次握手

> 如何加深理解？模拟一次 tls 4次握手

1. 客户端->服务端：`clientHello`、`tls版本`、`可用的加密算法集合`、`可用的压缩算法`、`第一个随机数`
2. 服务端->客户端：`serverHello`、`采用的tls版本`、`采用的加密算法`、`采用的压缩算法`、`ca证书，含公钥`、`第二个随机数`
3. 客户端->服务端: `确认加密结束`、`第三个随机数`、`ack`
4. 服务端->客户端：`确认加密`、`ack`

> 相比与 tcp 的3次握手， tls 的4次握手，就是多了 `tls版本`、`加密算法`、`压缩算法`、`ca证书及公钥`、`随机数`，每次会话都需要进行 tls 4次握手，所以 http2 采用了长链接
> 随机数作用：公钥只是用来加密，非对称加密；随机数用于每次会话生成对称加密；第三个随机数会用第二次握手服务器提供的公钥进行加密

**工作过程**：4次握手结束之后，然后就普通 http 通信了，不过数据都才用会话密钥进行加密传输。这里的会话密钥就是通过那3个随机数、采用的加密算法生成的。比如 RSA密钥交换算法 + 3个随机数 = 特定对称密钥

**公钥作用**：服务器提供的公钥，用于第三个随机数加密

**私钥作用**：服务器解密第三个随机数

**对称密钥作用**：握手之后的 http 通信数据加密
