# react源码阅读

time: 2018.7.20

heyunjiang

## 为什么阅读源码

目前我已经深入学习了 html, js, dom (肯定需要补充学习)，接下来就是 react + nodejs 了。首先选择 react ，作为基本的前端能力(吃饭工具)。

之前有做过 react 的项目，但是都是停留在表面的基础应用，甚至是用的别人的集成框架，自己写的纯 react 项目写的不多，对 react 的应用主要体现在 `ReactDom.render` , `jsx` , `生命周期` , `extends React.Component`，`虚拟 dom` 。

现在需要对 react 深入学习，知晓它的内部实现原理，组织架构方式，方便以后 `bug 定位` 、 `项目扩展` 、 `项目组织架构优化` 、 `第三方工具搭配使用` ，甚至是自己写一套前端框架。

## 步骤

1. 回顾、熟悉已做项目
2. 回顾官网教程文档 (由于时间限制，本次回顾只看了大部分内容，在第一次课堂结束后再回顾)
3. 总结归纳问题
4. 开始阅读源码分析教程

## 阅读源码要解决什么问题

### 1 react 整体组织架构是什么方式的？如果我要自己做套框架，需要做什么，怎么做？

### 2 react 是如何控制虚拟 dom 与真实 dom之间的联系？从几个方面来回答：结构、更新方式、性能

更新方式(协调)

1. 节点元素类型改变：如果一个节点元素类型发生改变，那么它及它的后代都会被重新创建
2. 节点元素属性改变：如果一个节点元素类型不变，属性改变，那么将只会更新它的属性
3. 组件props改变：如果一个组件元素类型不变，组件发生更新，那么react将保持实例不变，通过更新组件的 props 来触发更新，产生新元素，并在底层实例上依次调用 `componentWillReceiveProps()` 和 `componentWillUpdate()`，组件触发更新完毕。接下来调用 `render()` 方法，执行第一、二点进行更新
4. 列表更新：与前面3点不同，列表的项是一种相对稳定的结构，列表渲染需要增加一个 `key` 值，当每次插入或删除列表项的时候，通过对比key值，可以减少对比次数，增加更新效率。key 最好用 id 标识，如果用序号 index 标识，重新排序列表的时候，每项的 index 会发生变化，从而 key 变化，可能会产生意想不到的变化。key 要求在兄弟节点之间唯一，不用全局唯一

> key 应该是稳定的，否则将使得大量组件实例和dom节点进行不必要的重建，使得性能下降、丢失子组件的状态

### 3 jsx 如何编译？从几个方面来回答：jsx 特性、编译

特性

1. 会移除空行和开始、结尾处的空格，也会移除标签邻近的新行(回车)，字符串内部的换行会被替换成一个空格
2. 作为 `React.createElement(components, props, ...children)` 的语法糖
3. js 表达式需要用 `{}` 包裹起来
4. jsx 中的 boolean, null, undefined 会被忽略

### 4 生命周期如何控制？从几个方面来回答：每个钩子函数实现位置、设计目的

### 5 组件构建方式？有状态组件实现了什么功能？从几个方面来回答：有状态组件相对于无状态组件多了几样东西、组件通信方式、与 jsx 的联系

组件通信方式

1. 父子：props + callback
2. 兄弟：共同父亲
3. Context：全局数据，redux就是基于此实现，主要用于解决跨多个父亲节点传递props问题

> React.Fragment，语法糖 `<></>` ，用以解决 return 方法中保证只有一个根节点问题

### 6 提供了哪些开放接口，用于和 router、flux 等第三方对接？

### 7 react 如何实现事件，合成事件，与 jsx 的联系？

### 8 react 对html标签的处理，与 jsx 的联系？

### 9 react 服务端渲染原理

## 源码总结

源码地址：[facebook/react](https://github.com/facebook/react)

react 版本： v 0.3.3 stable

http-server: [http-server](https://github.com/indexzero/http-server)
